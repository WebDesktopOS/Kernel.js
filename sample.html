<script src='kernel.js'></script>

<script>
	
	K.module.define('MyModule', function(router)
	{
		var self = this;
		
		// Public api
		self.init = function()
		{
			router.listen('custom-event', function(data)
			{
				console.log(data);
			}, self);
			
			router.notify({
				type: 'custom-event',
				data: 'Hello, I am a custom event.'
			});
		};
	});
	
	K.module.define('MyOtherModule', function(router)
	{
		var self = this;
		
		// Public api
		self.init = function()
		{
			router.listen(['custom-event', 'foo'], function(data)
			{
				console.log('DATA: '+data);
			}, self);
			
			// Kill itself for fun
			router.toggleModule(self.id);
		}
	});
	
	K.router.define('main', function()
	{
		var self = this;
		
		self.toggleModule = function(id, config)
		{
		    if (K.getModule(id))
		    {
		        K.stop(id);
		    }
		    else
		    {
		        K.start(id, config);
		    }
		};
	});
	
	K.extend({
		foo: 'bar',
		onStart: function(instance, config)
		{
		    console.log('Instance is starting!');
		    instance.init();
		},
		onStop: function(instance)
        {
            console.log('Instance is stopping!');
            instance.kill();
        }
	});
	
	K.register('module1', 'MyModule');
	K.register('module2', 'MyOtherModule');
	
	K.start('module2', {placement: 'foo'});
	K.start('module1', {placement: 'foo'});
	
	var stuff = K._internals;
	
	console.log(stuff);
	
</script>
